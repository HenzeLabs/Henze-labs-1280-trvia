<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Game - 1280 Trivia</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <div class="container mobile-friendly">
      <div class="header">
        <h1>Create Game</h1>
        <a href="/" class="btn">‚Üê Back</a>
      </div>

      <div id="create-form" class="section">
        <h2>Enter Your Name</h2>

        <div class="form-group">
          <label for="player-name">Your Name:</label>
          <input type="text" id="player-name" placeholder="Enter your name" autofocus />
        </div>

        <button id="create-game-btn" class="btn btn-primary">Create Game</button>

        <div id="create-error" class="error-message hidden"></div>
      </div>

      <div id="creating-game" class="section hidden">
        <h2>Creating Game...</h2>
        <div class="loading-spinner"></div>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
      const app = new TriviaApp();

      document.getElementById('create-game-btn').addEventListener('click', async () => {
        const playerName = document.getElementById('player-name').value.trim();

        if (!playerName) {
          document.getElementById('create-error').textContent = 'Please enter your name';
          document.getElementById('create-error').classList.remove('hidden');
          return;
        }

        // Show loading
        document.getElementById('create-form').classList.add('hidden');
        document.getElementById('creating-game').classList.remove('hidden');

        try {
          const response = await app.apiCall('/game/create', {
            method: 'POST',
            body: JSON.stringify({
              player_name: playerName,
              num_questions: 15
            })
          });

          if (response.success) {
            // Store player info
            sessionStorage.setItem('player_id', response.player_id);
            sessionStorage.setItem('room_code', response.room_code);
            sessionStorage.setItem('is_creator', 'true');
            sessionStorage.setItem('player_name', playerName);

            // Redirect to player view
            window.location.href = `/player/${response.player_id}`;
          } else {
            throw new Error(response.message || 'Failed to create game');
          }
        } catch (error) {
          console.error('Error creating game:', error);
          document.getElementById('creating-game').classList.add('hidden');
          document.getElementById('create-form').classList.remove('hidden');
          document.getElementById('create-error').textContent = error.message || 'Failed to create game. Please try again.';
          document.getElementById('create-error').classList.remove('hidden');
        }
      });

      // Allow Enter key to submit
      document.getElementById('player-name').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('create-game-btn').click();
        }
      });
    </script>
  </body>
</html>
