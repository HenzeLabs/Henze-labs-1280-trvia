<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>1280 Trivia - TV View [V5-ALIGNED]</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/unified-responsive.css') }}"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  </head>

  <body class="tv-view">
    <div class="tv-container">
      <!-- Header -->
      <div class="tv-header">
        <div class="tv-logo">1280 TRIVIA</div>
        <div class="tv-room-code" data-testid="tv-room-code">
          {{ room_code }}
        </div>
        <div class="tv-progress">
          <span id="tv-current-question" data-testid="tv-current-question"
            >0</span
          >
          /
          <span id="tv-total-questions" data-testid="tv-total-questions"
            >0</span
          >
        </div>
      </div>

      <!-- Status Banner -->
      <div
        id="tv-status-banner"
        data-testid="all-answered-banner"
        class="tv-status-banner hidden"
      ></div>

      <!-- Waiting Screen -->
      <div id="tv-waiting" data-testid="tv-waiting" class="tv-content">
        <div class="tv-waiting">
          <div class="tv-room-code-badge">
            <div class="tv-room-code-badge-label">Room Code</div>
            <div class="tv-room-code-badge-code">{{ room_code }}</div>
          </div>

          <p>Join at <strong id="tv-join-url"></strong></p>

          <div class="tv-qr-code-container">
            <div class="tv-qr-label">Scan to Join</div>
            <div id="tv-qr-code"></div>
          </div>

          <div class="tv-player-count-section">
            <div class="tv-player-count">
              <span id="tv-player-count">0</span>
            </div>
            <div class="tv-player-count-label">Players Ready</div>
          </div>

          <div class="tv-controls">
            <button
              id="start-game-btn"
              data-testid="start-game-btn"
              class="tv-btn"
              disabled
            >
              Start Game
            </button>
            <button id="end-game-btn" class="tv-btn tv-btn-secondary">
              End Game
            </button>
          </div>
        </div>
      </div>

      <!-- Question Screen -->
      <div id="tv-question" class="tv-content tv-question-container hidden">
        <div class="tv-category" id="tv-category"></div>
        <div
          class="tv-question-text"
          id="tv-question-text"
          data-testid="question-text"
        ></div>
        <div class="tv-answers" id="tv-answers"></div>
        <div class="tv-answer-status" id="tv-answer-status"></div>
      </div>

      <!-- Leaderboard -->
      <div id="tv-leaderboard" class="tv-content tv-leaderboard hidden">
        <h2>Leaderboard</h2>
        <div class="tv-leaderboard-list" id="tv-leaderboard-list"></div>
      </div>

      <!-- Minigame Screen -->
      <div id="tv-minigame" class="tv-content tv-minigame hidden">
        <h2>KILLING FLOOR</h2>
        <div class="tv-minigame-message" id="tv-minigame-message"></div>
        <div class="tv-minigame-results" id="tv-minigame-results"></div>
      </div>

      <!-- Final Sprint -->
      <div id="tv-final-sprint" class="tv-content tv-final-sprint hidden">
        <h2>FINAL SPRINT</h2>
        <p style="font-size: 36px; margin-bottom: 40px">
          Race to <span id="tv-sprint-goal">5</span> correct answers!
        </p>
        <div class="tv-sprint-progress" id="tv-sprint-progress"></div>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
      const ROOM_CODE = "{{ room_code }}";

      // Generate QR code when page loads
      document.addEventListener("DOMContentLoaded", function () {
        const joinUrl = `${window.location.origin}/join`;
        const joinUrlElement = document.getElementById("tv-join-url");
        if (joinUrlElement) {
          joinUrlElement.textContent = joinUrl;
        }

        const qrTarget = document.getElementById("tv-qr-code");
        if (qrTarget) {
          new QRCode(qrTarget, {
            text: joinUrl,
            width: 100,
            height: 100,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H,
          });
        }
      });
    </script>
    <script src="{{ url_for('static', filename='js/tv.js') }}"></script>
  </body>
</html>
